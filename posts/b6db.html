<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Redis从入门到放弃, 流觞の博客"><meta name="description" content=""><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Redis从入门到放弃 | 流觞の博客</title><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/awesome/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/aos/aos.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/animate/animate.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/CDN/css/matery.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/css/my.css"><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/jquery/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="流觞の博客" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">流觞の博客</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-share-alt" style="zoom:.6"></i> <span>友人帐</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/box/cn" class="waves-effect waves-light"><i class="fas fa-location-arrow" style="zoom:.6"></i> <span>聚宝盒</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">流觞の博客</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-share-alt"></i> 友人帐</a></li><li class="m-nav-item"><a href="/box/cn" class="waves-effect waves-light"><i class="fa-fw fas fa-location-arrow"></i> 聚宝盒</a></li><li><div class="divider"></div></li><li><a href="https://github.com/nfLJ/nfLJ.github.io.git" rel="external nofollow noreferrer" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/nfLJ/nfLJ.github.io.git" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/featureimages/1.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Redis从入门到放弃</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{height:calc(100vh - 250px);overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Redis/" class="post-category">Redis</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2020-07-31</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 7.8k</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h1 id="1-Redis-介绍"><a href="#1-Redis-介绍" class="headerlink" title="1. Redis 介绍"></a>1. Redis 介绍</h1><h2 id="1-1-NoSQL-基本概念"><a href="#1-1-NoSQL-基本概念" class="headerlink" title="1.1 NoSQL 基本概念"></a>1.1 NoSQL 基本概念</h2><p>为了解决高并发、高可用、高可扩展，大数据存储等一系列问题而产生的数据库解决方案，就是NoSql。</p><p>NoSql，叫非关系型数据库，它的全名Not only sql。它不能替代关系型数据库，只能作为关系型数据库的一个良好补充。</p><h2 id="1-2-NoSQL-分类"><a href="#1-2-NoSQL-分类" class="headerlink" title="1.2 NoSQL 分类"></a>1.2 NoSQL 分类</h2><ul><li>键值(Key-Value)存储数据库 相关产品： Tokyo Cabinet/Tyrant、Redis、Voldemort、Berkeley DB 典型应用： 内容缓存，主要用于处理大量数据的高访问负载。 数据模型： 一系列键值对 优势： 快速查询 劣势： 存储的数据缺少结构化</li><li>列存储数据库 相关产品：Cassandra, HBase, Riak 典型应用：分布式的文件系统 数据模型：以列簇式存储，将同一列数据存在一起 优势：查找速度快，可扩展性强，更容易进行分布式扩展 劣势：功能相对局限</li><li>文档型数据库 相关产品：CouchDB、MongoDB 典型应用：Web应用（与Key-Value类似，Value是结构化的） 数据模型： 一系列键值对 优势：数据结构要求不严格 劣势： 查询性能不高，而且缺乏统一的查询语法</li><li>图形(Graph)数据库 相关数据库：Neo4J、InfoGrid、Infinite Graph 典型应用：社交网络 数据模型：图结构 优势：利用图结构相关算法。 劣势：需要对整个图做计算才能得出结果，不容易做分布式的集群方案。</li></ul><h2 id="1-3-Redis-基本概念"><a href="#1-3-Redis-基本概念" class="headerlink" title="1.3 Redis 基本概念"></a>1.3 Redis 基本概念</h2><p>Redis是使用c语言开发的一个高性能键值数据库。Redis可以通过一些键值类型来存储数据。 键值类型： String字符类型 map散列类型 list列表类型 set集合类型 sortedset有序集合类型</p><h2 id="1-4-发展历史"><a href="#1-4-发展历史" class="headerlink" title="1.4 发展历史"></a>1.4 发展历史</h2><p>2008年，意大利的一家创业公司Merzia推出了一款基于MySQL的网站实时统计系统LLOOGG，然而没过多久该公司的创始人 Salvatore Sanfilippo便 对MySQL的性能感到失望，于是他决定亲自为LLOOGG量身定做一个数据库，并于2009年开发完成，这个数据库就是Redis。 不过Salvatore Sanfilippo并不满足只将Redis用于LLOOGG这一款产品，而是希望更多的人使用它，于是在同一年Salvatore Sanfilippo将Redis开源发布，并开始和Redis的另一名主要的代码贡献者Pieter Noordhuis一起继续着Redis的开发，直到今天。</p><p>Salvatore Sanfilippo自己也没有想到，短短的几年时间，Redis就拥有了庞大的用户群体。Hacker News在2012年发布了一份数据库的使用情况调查，结果显示有近12%的公司在使用Redis。国内如新浪微博、街旁网、知乎网，国外如GitHub、Stack Overflow、Flickr等都是Redis的用户。</p><p>VMware公司从2010年开始赞助Redis的开发， Salvatore Sanfilippo和Pieter Noordhuis也分别在3月和5月加入VMware，全职开发Redis。</p><h2 id="1-5-应用场景"><a href="#1-5-应用场景" class="headerlink" title="1.5 应用场景"></a>1.5 应用场景</h2><p>缓存（数据查询、短连接、新闻内容、商品内容等等）。（最多使用） 分布式集群架构中的session分离。 聊天室的在线好友列表。 任务队列。（秒杀、抢购、12306等等） 应用排行榜。 网站访问统计。 数据过期处理（可以精确到毫秒）</p><h1 id="2-Redis-安装"><a href="#2-Redis-安装" class="headerlink" title="2. Redis 安装"></a>2. Redis 安装</h1><h2 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1 下载"></a>2.1 下载</h2><p>官网地址：<a href="http://redis.io/" target="_blank" rel="noopener external nofollow noreferrer">http://redis.io/</a> 下载地址：<a href="http://download.redis.io/releases/redis-3.0.0.tar.gz" target="_blank" rel="noopener external nofollow noreferrer">http://download.redis.io/releases/redis-3.0.0.tar.gz</a></p><h2 id="2-2-安装"><a href="#2-2-安装" class="headerlink" title="2.2 安装"></a>2.2 安装</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#sftp 上传安装包到linux</span>
<span class="token comment" spellcheck="true">#解压</span>
<span class="token function">tar</span> -zxvf redis.3.0.0.tar.gz
<span class="token comment" spellcheck="true">#安装c语言环境</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gcc-c++
<span class="token comment" spellcheck="true">#编译</span>
<span class="token function">cd</span> redis-3.0.0
<span class="token function">make</span>
<span class="token comment" spellcheck="true">#安装</span>
<span class="token function">make</span> <span class="token function">install</span> PREFIX <span class="token operator">=</span> /usr/local/redis
<span class="token comment" spellcheck="true"># 查看</span>
<span class="token function">cd</span> /usr/local/redis
<span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-3-redis-启动"><a href="#2-3-redis-启动" class="headerlink" title="2.3 redis 启动"></a>2.3 redis 启动</h2><h3 id="2-3-1-前端启动"><a href="#2-3-1-前端启动" class="headerlink" title="2.3.1 前端启动"></a>2.3.1 前端启动</h3><ul><li>前端启动命令 <code>./redis-server</code></li><li>前端启动的关闭 强制关闭 <code>ctrl+c</code> 正常关闭 <code>./redis-cli shutdown</code></li></ul><p><strong>tips:</strong>一旦客户端关闭，则redis服务也会停掉</p><h3 id="2-3-2-后端启动"><a href="#2-3-2-后端启动" class="headerlink" title="2.3.2 后端启动"></a>2.3.2 后端启动</h3><ul><li>将 redis 源码包中的 redis.conf 文件拷贝至 bin 目录下 <code>cp /root/redis-3.0.0/redis.conf</code></li><li>修改 redis.conf 文件，将 daemonize 改为 yes <code>vim redis.conf</code></li><li>使用后端命令启动 redis <code>./redis-server redis.conf</code></li><li>查看是否启动成功 <code>ps -aux | grep redis</code></li><li>关闭后端启动的方式 强制关闭： <code>kill -9 进程号</code> 正常关闭：<code>./redis-cli shutdown</code></li></ul><h1 id="3-Redis-客户端"><a href="#3-Redis-客户端" class="headerlink" title="3. Redis 客户端"></a>3. Redis 客户端</h1><h2 id="3-1-自带客户端"><a href="#3-1-自带客户端" class="headerlink" title="3.1 自带客户端"></a>3.1 自带客户端</h2><ul><li>启动 <code>./redis-cli -h 127.0.0.1 -p 6379</code> -h 指定访问 redis 服务器的 ip 地址 -p 指定访问的 redis 服务器的 port 端口 还可以写成 ./redis-cli 使用默认配置，默认ip 127.0.0.1,默认端口 6379</li><li>关闭 ctrl + c 127.0.0.1:6379&gt;quit</li></ul><h2 id="3-2-图形界面客户端"><a href="#3-2-图形界面客户端" class="headerlink" title="3.2 图形界面客户端"></a>3.2 图形界面客户端</h2><p>redis-desktop-manager 打开如下：</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729115714.jpeg" alt="img"></p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729115720.jpeg" alt="img"></p><p>选择数据库方式： select 加上数据库的下标，就可以选择指定的数据库使用，下标从0开始。</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">select</span> 15
OK
127.0.0.1:6379<span class="token punctuation">[</span>15<span class="token punctuation">]</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="3-3-jedis-客户端"><a href="#3-3-jedis-客户端" class="headerlink" title="3.3 jedis 客户端"></a>3.3 jedis 客户端</h2><h3 id="3-3-1-介绍"><a href="#3-3-1-介绍" class="headerlink" title="3.3.1 介绍"></a>3.3.1 介绍</h3><p>Redis不仅是使用命令来操作，现在基本上主流的语言都有客户端支持，比如java、C、C#、C++、php、Node.js、Go等。</p><p>在官方网站里列一些Java的客户端，有Jedis、Redisson、Jredis、JDBC-Redis、等其中官方推荐使用Jedis和Redisson。 在企业中用的最多的就是Jedis，下面我们就重点学习下Jedis。</p><p>Jedis同样也是托管在github上，地址：<a href="https://github.com/xetorthio/jedis" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/xetorthio/jedis</a></p><h3 id="3-3-2-工程搭建"><a href="#3-3-2-工程搭建" class="headerlink" title="3.3.2 工程搭建"></a>3.3.2 工程搭建</h3><ul><li>添加 jar commons-pool2-2.3.jar jedis-2.7.0.jar</li></ul><h4 id="3-3-2-1-单例连接-redis"><a href="#3-3-2-1-单例连接-redis" class="headerlink" title="3.3.2.1 单例连接 redis"></a>3.3.2.1 单例连接 redis</h4><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729115753.jpeg" alt="img"></p><h4 id="3-3-2-2-使用连接池连接-redis"><a href="#3-3-2-2-使用连接池连接-redis" class="headerlink" title="3.3.2.2 使用连接池连接 redis"></a>3.3.2.2 使用连接池连接 redis</h4><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729115759.jpeg" alt="img"></p><h4 id="3-3-2-3-Spring-整合-jedisPool"><a href="#3-3-2-3-Spring-整合-jedisPool" class="headerlink" title="3.3.2.3 Spring 整合 jedisPool"></a>3.3.2.3 Spring 整合 jedisPool</h4><p>添加 spring 的 jar 包 配置 spring 配置文件 applicationContext.xml</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>
    xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span> xmlns<span class="token operator">:</span>mvc<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/mvc"</span>
    xmlns<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/context"</span>
    xmlns<span class="token operator">:</span>aop<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/aop"</span> xmlns<span class="token operator">:</span>tx<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/tx"</span>
    xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>"http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">.</span>xsd
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>mvc
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>mvc<span class="token operator">/</span>spring<span class="token operator">-</span>mvc<span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">.</span>xsd
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context<span class="token operator">/</span>spring<span class="token operator">-</span>context<span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">.</span>xsd
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>aop
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>aop<span class="token operator">/</span>spring<span class="token operator">-</span>aop<span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">.</span>xsd
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>tx
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>tx<span class="token operator">/</span>spring<span class="token operator">-</span>tx<span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">.</span>xsd "<span class="token operator">></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接池配置 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"jedisPoolConfig"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.JedisPoolConfig"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最大连接数 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"maxTotal"</span> value<span class="token operator">=</span><span class="token string">"30"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最大空闲连接数 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"maxIdle"</span> value<span class="token operator">=</span><span class="token string">"10"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 每次释放连接的最大数目 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"numTestsPerEvictionRun"</span> value<span class="token operator">=</span><span class="token string">"1024"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 释放连接的扫描间隔（毫秒） <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"timeBetweenEvictionRunsMillis"</span> value<span class="token operator">=</span><span class="token string">"30000"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接最小空闲时间 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"minEvictableIdleTimeMillis"</span> value<span class="token operator">=</span><span class="token string">"1800000"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接空闲多久后释放<span class="token punctuation">,</span> 当空闲时间<span class="token operator">></span>该值 且 空闲连接<span class="token operator">></span>最大空闲连接数 时直接释放 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"softMinEvictableIdleTimeMillis"</span> value<span class="token operator">=</span><span class="token string">"10000"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 获取连接时的最大等待毫秒数<span class="token punctuation">,</span>小于零<span class="token operator">:</span>阻塞不确定的时间<span class="token punctuation">,</span>默认<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"maxWaitMillis"</span> value<span class="token operator">=</span><span class="token string">"1500"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在获取连接的时候检查有效性<span class="token punctuation">,</span> 默认<span class="token boolean">false</span> <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"testOnBorrow"</span> value<span class="token operator">=</span><span class="token string">"false"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在空闲时检查有效性<span class="token punctuation">,</span> 默认<span class="token boolean">false</span> <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"testWhileIdle"</span> value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接耗尽时是否阻塞<span class="token punctuation">,</span> <span class="token boolean">false</span>报异常<span class="token punctuation">,</span>ture阻塞直到超时<span class="token punctuation">,</span> 默认<span class="token boolean">true</span> <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"blockWhenExhausted"</span> value<span class="token operator">=</span><span class="token string">"false"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> redis单机 通过连接池 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"jedisPool"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.JedisPool"</span>
        destroy<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">"close"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"poolConfig"</span> ref<span class="token operator">=</span><span class="token string">"jedisPoolConfig"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"host"</span> value<span class="token operator">=</span><span class="token string">"192.168.242.130"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"port"</span> value<span class="token operator">=</span><span class="token string">"6379"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试代码</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJedisPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    JedisPool pool <span class="token operator">=</span> <span class="token punctuation">(</span>JedisPool<span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"jedisPool"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Jedis jedis <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 关闭连接</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-数据类型"><a href="#4-数据类型" class="headerlink" title="4. 数据类型"></a>4. 数据类型</h1><h2 id="4-1-String-类型"><a href="#4-1-String-类型" class="headerlink" title="4.1 String 类型"></a>4.1 String 类型</h2><p>赋值 set key value</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> <span class="token function">test</span> 123
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>取值 get key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> get <span class="token function">test</span>
<span class="token string">"123"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>取值并赋值 getset key value</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> getset <span class="token function">test</span> 321
<span class="token string">"123"</span>
127.0.0.1:6379<span class="token operator">></span> get <span class="token function">test</span>
<span class="token string">"321"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>设置获取多个键值 mset key value [key value…] mget key [key…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> mset k1 v1 k2 v2 k3 v3
OK
127.0.0.1:6379<span class="token operator">></span> mget k1 k2
1<span class="token punctuation">)</span> <span class="token string">"v1"</span>
2<span class="token punctuation">)</span> <span class="token string">"v2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除 del key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> del <span class="token function">test</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>数值增减</p><ul><li><p>递增数字 当存储的字符串是整数时，Redis提供了一个实用的命令INCR，其作用是让当前键值递增，并返回递增后的值。 语法：incr key</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> num 1
  OK
  127.0.0.1:6379<span class="token operator">></span> incr num
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
  127.0.0.1:6379<span class="token operator">></span> incr num
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
  127.0.0.1:6379<span class="token operator">></span> incr num
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>增加指定的整数 incrby key increment</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> incrby num 2
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 8
  127.0.0.1:6379<span class="token operator">></span> incrby num 2
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>递减数值 decr key</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> decr num
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 9
  127.0.0.1:6379<span class="token operator">></span> decr num
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>减少指定的数值 decryby key decrement</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> decrby num 2
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 6
  127.0.0.1:6379<span class="token operator">></span> decrby num 2
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>向尾部追加值 APPEND的作用是向键值的末尾追加value。如果键不存在则将该键的值设置为value，即相当于 SET key value。返回值是追加后字符串的总长度。 语法：append key value</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> str hello
OK
127.0.0.1:6379<span class="token operator">></span> append str <span class="token string">"world"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10
127.0.0.1:6379<span class="token operator">></span> get str
<span class="token string">"helloworld"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获取字符串长度 STRLEN命令返回键值的长度，如果键不存在则返回0。 语法：strlen key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> strlen str
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>应用</p><ul><li>自增主键 商品编号、订单号采用 string 的递增数字特性生成</li></ul><h2 id="4-2-Hash-散列类型"><a href="#4-2-Hash-散列类型" class="headerlink" title="4.2 Hash 散列类型"></a>4.2 Hash 散列类型</h2><h3 id="4-2-1-使用-string-的问题"><a href="#4-2-1-使用-string-的问题" class="headerlink" title="4.2.1 使用 string 的问题"></a>4.2.1 使用 string 的问题</h3><p>假设有User对象以JSON序列化的形式存储到Redis中，User对象有id，username、password、age、name等属性，存储的过程如下： 保存、更新：User对象 json(string) redis</p><p>如果在业务上只是更新age属性，其他的属性并不做更新我应该怎么做呢？ 如果仍然采用上边的方法在传输、处理时会造成资源浪费，下边讲的hash可以很好的解决这个问题。</p><h3 id="4-2-2-介绍"><a href="#4-2-2-介绍" class="headerlink" title="4.2.2 介绍"></a>4.2.2 介绍</h3><p>hash叫散列类型，它提供了字段和字段值的映射。字段值只能是字符串类型，不支持散列类型、集合类型等其它类型。如下：</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729115854.jpeg" alt="img"></p><h3 id="4-2-3-命令"><a href="#4-2-3-命令" class="headerlink" title="4.2.3 命令"></a>4.2.3 命令</h3><p>赋值 HSET命令不区分插入和更新操作，当执行插入操作时HSET命令返回1，当执行更新操作时返回0。</p><ul><li><p>一次只设置一个字段值 语法：hset key field value</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> hset user username zhangsan
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>一次设置多个字段值 语法：hmset key field value [field value…]</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> hmset user age 20 username lisi
  OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>当字段不存在时赋值，类似hset,区别在于如果字段存在，该命令不执行任何操作。 语法：hsetnx key field value</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> hsetnx user age 30
  <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><p>取值</p><ul><li><p>一次获取一个字段值 语法：hget key field</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> hget user username
  <span class="token string">"lisi"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>一次可以获取多个字段值 语法：hmget key field [field…]</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> hmget user age username
  1<span class="token punctuation">)</span> <span class="token string">"20"</span>
  2<span class="token punctuation">)</span> <span class="token string">"lisi"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>获取所有字段值 语法：hgetall key</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> hgetall user
  1<span class="token punctuation">)</span> <span class="token string">"username"</span>
  2<span class="token punctuation">)</span> <span class="token string">"lisi"</span>
  3<span class="token punctuation">)</span> <span class="token string">"age"</span>
  4<span class="token punctuation">)</span> <span class="token string">"20"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>删除字段 可以删除一个或多个字段，返回值是被删除的字段的个数。 语法：hdel key field [field…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hdel user age
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hdel user age username
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>增加数字 语法：hincrby key field increment</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hincrby user age 2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>判断字段是否存在 语法：hexists key field</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hexists user age
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>只获取字段名或字段值 语法： hkeys key hvals key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hkeys user
1<span class="token punctuation">)</span> <span class="token string">"age"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>获取字段数量 语法：hlen key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hlen user
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>应用 存储商品信息</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hlen user
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>获取商品信息</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hgetall items:1001
1<span class="token punctuation">)</span> <span class="token string">"id"</span>
2<span class="token punctuation">)</span> <span class="token string">"3"</span>
3<span class="token punctuation">)</span> <span class="token string">"name"</span>
4<span class="token punctuation">)</span> <span class="token string">"apple"</span>
5<span class="token punctuation">)</span> <span class="token string">"price"</span>
6<span class="token punctuation">)</span> <span class="token string">"5.00"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-3-List-类型"><a href="#4-3-List-类型" class="headerlink" title="4.3 List 类型"></a>4.3 List 类型</h2><h3 id="4-3-1-ArrayList-和-LinkedList-的区别"><a href="#4-3-1-ArrayList-和-LinkedList-的区别" class="headerlink" title="4.3.1 ArrayList 和 LinkedList 的区别"></a>4.3.1 ArrayList 和 LinkedList 的区别</h3><p>Arraylist是使用数组来存储数据，特点：查询快、增删慢</p><p>Linkedlist是使用双向链表存储数据，特点：增删快、查询慢，但是查询链表两端的数据也很快。</p><p>Redis的list是采用来链表来存储的，所以对于redis的list数据类型的操作，是操作list的两端数据来操作的。</p><h3 id="4-3-2-命令"><a href="#4-3-2-命令" class="headerlink" title="4.3.2 命令"></a>4.3.2 命令</h3><p>向列表两端增加元素</p><ul><li>向列表左边增加元素 语法：lpush key value [value…]</li></ul><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lpush list:1 1 2 3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>向列表右边增加元素 语法：rpush key value [value…]</li></ul><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> rpush list:1 4 5 6
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>查看列表 LRANGE命令是列表类型最常用的命令之一，获取列表中的某一片段，将返回start、stop之间的所有元素（包含两端的元素），索引从0开始。索引可以是负数，如：“-1”代表最后边的一个元素。</p><p>语法：lrange key start stop</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 2
1<span class="token punctuation">)</span> <span class="token string">"3"</span>
2<span class="token punctuation">)</span> <span class="token string">"2"</span>
3<span class="token punctuation">)</span> <span class="token string">"1"</span>
127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"3"</span>
2<span class="token punctuation">)</span> <span class="token string">"2"</span>
3<span class="token punctuation">)</span> <span class="token string">"1"</span>
4<span class="token punctuation">)</span> <span class="token string">"4"</span>
5<span class="token punctuation">)</span> <span class="token string">"5"</span>
6<span class="token punctuation">)</span> <span class="token string">"6"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从列表两端弹出元素 LPOP命令从列表左边弹出一个元素，会分两步完成：</p><ul><li><p>第一步是将列表左边的元素从列表中移除</p></li><li><p>第二步是返回被移除的元素值。 语法： lpop key rpop key</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> lpop list:1
  <span class="token string">"3"</span>
  127.0.0.1:6379<span class="token operator">></span> rpop list:1
  <span class="token string">"6"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>获取列表中元素的个数 语法：llen key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> llen list:1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>删除列表中指定的值 LREM命令会删除列表中前count个值为value的元素，返回实际删除的元素个数。根据count值的不同，该命令的执行方式会有所不同：</p><ul><li>当count&gt;0时， LREM会从列表左边开始删除。</li><li>当count&lt;0时， LREM会从列表后边开始删除。</li><li>当count=0时， LREM删除所有值为value的元素。</li></ul><p>语法：lrem key count value</p><p>获得/设置指定索引的元素值</p><ul><li><p>获得指定索引的元素值 语法：lindex key index</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> lindex list:1 2
  <span class="token string">"4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>设置指定索引的元素值 语法：lset key index value</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> lset list:1 2 2
  OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><p>只保留列表指定片段 指定范围和 lrange 一致 语法：ltrim key start stop</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"2"</span>
4<span class="token punctuation">)</span> <span class="token string">"5"</span>
127.0.0.1:6379<span class="token operator">></span> ltrim list:1 0 2
OK
127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>向列表中插入元素 该命令首先会在列表中从左到右查找值为pivot的元素，然后根据第二个参数是BEFORE还是AFTER来决定将value插入到该元素的前面还是后面。 语法：linsert key before | after pivot value</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> linsert list:1 after 1 9
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"9"</span>
4<span class="token punctuation">)</span> <span class="token string">"2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将元素从一个列表转移到另一个列表 语法：rpoplpush source destination</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"9"</span>
4<span class="token punctuation">)</span> <span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> rpoplpush list:1 newlist
<span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> lrange newlist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> lrange list:1 0 -1
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"9"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>应用 在Redis中创建商品评论列表 用户发布商品评论，将评论信息转成json存储到list中。 用户在页面查询评论列表，从redis中取出json数据展示到页面。</p><p>定义商品评论列表key： 商品编号为1001的商品评论key【items: comment:1001】</p><h2 id="4-4-Set-类型"><a href="#4-4-Set-类型" class="headerlink" title="4.4 Set 类型"></a>4.4 Set 类型</h2><blockquote><p>集合类型：无序、不可重复 列表类型：有序、可重复</p></blockquote><h3 id="4-4-1-命令"><a href="#4-4-1-命令" class="headerlink" title="4.4.1 命令"></a>4.4.1 命令</h3><p>增加/删除元素 语法：sadd key member [member…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sadd <span class="token keyword">set</span> a b c
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> sadd <span class="token keyword">set</span> a
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>语法：srem key member [member…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> srem <span class="token keyword">set</span> c
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>获得集合中的所有元素 语法：smembers key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> smembers <span class="token keyword">set</span>
1<span class="token punctuation">)</span> <span class="token string">"b"</span>
2<span class="token punctuation">)</span> <span class="token string">"a"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>判断元素是否在集合中 语法：sismember key member</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sismember <span class="token keyword">set</span> a
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sismember <span class="token keyword">set</span> h
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-4-2-运算命令"><a href="#4-4-2-运算命令" class="headerlink" title="4.4.2 运算命令"></a>4.4.2 运算命令</h3><p>集合的差集运算 A-B 属于 A 并且 不属于 B 的元素构成的集合</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120006.jpeg" alt="img"></p><p>语法：sdiff key [key…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sadd setA 1 2 3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> sadd setB 2 3 4
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> <span class="token function">sdiff</span> setA setB
1<span class="token punctuation">)</span> <span class="token string">"1"</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token function">sdiff</span> setB setA
1<span class="token punctuation">)</span> <span class="token string">"4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>集合的交集运算 属于A且属于B的元素构成的集合</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120017.jpeg" alt="img"></p><p>语法：sinter key [key…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sinter setA setB
1<span class="token punctuation">)</span> <span class="token string">"2"</span>
2<span class="token punctuation">)</span> <span class="token string">"3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>集合的并集运算 属于 A 或者 属于 B 的元素构成的集合</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120030.jpeg" alt="img"></p><p>语法：sunion key [key…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sunion setA setB
1<span class="token punctuation">)</span> <span class="token string">"1"</span>
2<span class="token punctuation">)</span> <span class="token string">"2"</span>
3<span class="token punctuation">)</span> <span class="token string">"3"</span>
4<span class="token punctuation">)</span> <span class="token string">"4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获得集合中元素的个数 语法：scard key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> smembers setA
1<span class="token punctuation">)</span> <span class="token string">"1"</span>
2<span class="token punctuation">)</span> <span class="token string">"2"</span>
3<span class="token punctuation">)</span> <span class="token string">"3"</span>
127.0.0.1:6379<span class="token operator">></span> scard setA
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从集合中弹出一个元素 注意:由于集合是无序的，所有spop命令会从集合中随机选择一个元素弹出。 语法：spop key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> spop setA
<span class="token string">"2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="4-5-Sortedset-类型"><a href="#4-5-Sortedset-类型" class="headerlink" title="4.5 Sortedset 类型"></a>4.5 Sortedset 类型</h2><p>Sortedset 又叫 zset Sortedset 是有序集合，可排序的，但是唯一。 Sortedset 和 set 的不同之处，会给 set 中元素添加一个分数，然后通过这个分数进行排序。</p><h3 id="4-5-1-命令"><a href="#4-5-1-命令" class="headerlink" title="4.5.1 命令"></a>4.5.1 命令</h3><h4 id="4-5-1-1-增加元素"><a href="#4-5-1-1-增加元素" class="headerlink" title="4.5.1.1 增加元素"></a>4.5.1.1 增加元素</h4><p>向有序集合中加入一个元素和该元素的分数，如果该元素已经存在则会用新的分数替换原有的分数。返回值是新加入到集合中的元素个数，不包含之前已经存在的元素。 语法：zadd key score member [score member…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zadd scoreboard 80 zhangsan 89 lisi 94 wangwu
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> zadd scoreboard 97 lisi
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5-1-2-获取元素分数"><a href="#4-5-1-2-获取元素分数" class="headerlink" title="4.5.1.2 获取元素分数"></a>4.5.1.2 获取元素分数</h4><p>语法：zscore key member</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zscore scoreboard lisi
<span class="token string">"97"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-1-3-删除元素"><a href="#4-5-1-3-删除元素" class="headerlink" title="4.5.1.3 删除元素"></a>4.5.1.3 删除元素</h4><p>移除有序集key中的一个或多个成员，不存在的成员将被忽略。 当key存在但不是有序集类型时，返回一个错误。</p><p>语法：zrem key member [member…]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zrem scoreboard lisi
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-1-4-获得排名在某个范围的元素列表"><a href="#4-5-1-4-获得排名在某个范围的元素列表" class="headerlink" title="4.5.1.4 获得排名在某个范围的元素列表"></a>4.5.1.4 获得排名在某个范围的元素列表</h4><p>获得排名在某个范围的元素列表</p><ul><li><p>按照元素分数从小到大的顺序返回索引从start到stop之间的所有元素（包含两端的元素） 语法：zrange key start stop [withscores]</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> zrange scoreboard 0 2
  1<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
  2<span class="token punctuation">)</span> <span class="token string">"wangwu"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>按照元素分数从大到小的顺序返回索引从start到stop之间的所有元素（包含两端的元素） 语法：zrevrange key start stop [withscores]</p><pre class="line-numbers language-bash"><code class="language-bash">  127.0.0.1:6379<span class="token operator">></span> zrevrange scoreboard 0 2
  1<span class="token punctuation">)</span> <span class="token string">"wangwu"</span>
  2<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果需要获得元素的分数可以在命令末尾加上 withscores 参数 ··· 127.0.0.1:6379&gt; zrevrange scoreboard 0 2 withscores</p><ol><li>“wangwu”</li><li>“94”</li><li>“zhangsan”</li><li>“80” ···</li></ol></li></ul><h4 id="4-5-1-5-获取元素的排名"><a href="#4-5-1-5-获取元素的排名" class="headerlink" title="4.5.1.5 获取元素的排名"></a>4.5.1.5 获取元素的排名</h4><ul><li>从小到大 语法：zrank key member</li></ul><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zrank scoreboard zhangsan
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>从大到小 语法：zrevrank key member</li></ul><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zrevrank scoreboard zhangsan
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-1-6-获得指定分数范围的元素"><a href="#4-5-1-6-获得指定分数范围的元素" class="headerlink" title="4.5.1.6 获得指定分数范围的元素"></a>4.5.1.6 获得指定分数范围的元素</h4><p>语法：zrangebyscore key min max [withscores][limit offset count]</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> ZRANGEBYSCORE scoreboard 90 97 WITHSCORES
1<span class="token punctuation">)</span> <span class="token string">"wangwu"</span>
2<span class="token punctuation">)</span> <span class="token string">"94"</span>
3<span class="token punctuation">)</span> <span class="token string">"lisi"</span>
4<span class="token punctuation">)</span> <span class="token string">"97"</span>
127.0.0.1:6379<span class="token operator">></span> ZRANGEBYSCORE scoreboard 70 100 limit 1 2
1<span class="token punctuation">)</span> <span class="token string">"wangwu"</span>
2<span class="token punctuation">)</span> <span class="token string">"lisi"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5-1-7-增加某个元素的分数"><a href="#4-5-1-7-增加某个元素的分数" class="headerlink" title="4.5.1.7 增加某个元素的分数"></a>4.5.1.7 增加某个元素的分数</h4><p>返回值是更改后的分数 语法：zincrby key increment member</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> ZINCRBY scoreboard 4 lisi
"101“<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-1-8-获得集合中元素的数量"><a href="#4-5-1-8-获得集合中元素的数量" class="headerlink" title="4.5.1.8 获得集合中元素的数量"></a>4.5.1.8 获得集合中元素的数量</h4><p>语法：zcard key</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zcard scoreboard
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-1-9-获得指定分数范围内的元素个数"><a href="#4-5-1-9-获得指定分数范围内的元素个数" class="headerlink" title="4.5.1.9 获得指定分数范围内的元素个数"></a>4.5.1.9 获得指定分数范围内的元素个数</h4><p>语法：zcount key min max</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zcount scoreboard 80 90
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-1-10-按照排名范围删除元素"><a href="#4-5-1-10-按照排名范围删除元素" class="headerlink" title="4.5.1.10 按照排名范围删除元素"></a>4.5.1.10 按照排名范围删除元素</h4><p>语法：zremrangebyrank key start stop</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zremrangebyrank scoreboard 0 1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> zrange scoreboard 0 -1
1<span class="token punctuation">)</span> <span class="token string">"wangwu"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5-1-11-按照分数范围删除元素"><a href="#4-5-1-11-按照分数范围删除元素" class="headerlink" title="4.5.1.11 按照分数范围删除元素"></a>4.5.1.11 按照分数范围删除元素</h4><p>语法：zremrangebyscore key min max</p><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zadd scoreboard 84 zhangsan
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> ZREMRANGEBYSCORE scoreboard 80 100
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5-1-12-应用"><a href="#4-5-1-12-应用" class="headerlink" title="4.5.1.12 应用"></a>4.5.1.12 应用</h4><h5 id="4-5-1-13-商品销售排行榜"><a href="#4-5-1-13-商品销售排行榜" class="headerlink" title="4.5.1.13 商品销售排行榜"></a>4.5.1.13 商品销售排行榜</h5><p>需求：根据商品销售量对商品进行排行显示 思路：定义商品销售排行榜（sorted set集合），Key为items:sellsort，分数为商品销售量。</p><p>写入商品销售量：</p><ul><li>商品编号1001的销量是9，商品编号1002的销量是10 192.168.101.3:7007&gt; ZADD items:sellsort 9 1001 10 1002</li><li>商品编号1001的销量加1 192.168.101.3:7001&gt; ZINCRBY items:sellsort 1 1001</li><li>商品销量前10名： 192.168.101.3:7001&gt; ZRANGE items:sellsort 0 9 withscores</li></ul><h1 id="5-keys-命令"><a href="#5-keys-命令" class="headerlink" title="5. keys 命令"></a>5. keys 命令</h1><h2 id="5-1-常用命令"><a href="#5-1-常用命令" class="headerlink" title="5.1 常用命令"></a>5.1 常用命令</h2><ul><li>keys 返回满足给定pattern 的所有key redis 127.0.0.1:6379&gt; keys mylist*<ol><li>“mylist”</li><li>“mylist5”</li><li>“mylist6”</li><li>“mylist7”</li><li>“mylist8”</li></ol></li><li>exists 确认一个key 是否存在 示例：从结果来看，数据库中不存在HongWan 这个key，但是age 这个key 是存在的 redis 127.0.0.1:6379&gt; exists HongWan (integer) 0 redis 127.0.0.1:6379&gt; exists age (integer) 1 redis 127.0.0.1:6379&gt;</li><li>del 删除一个key redis 127.0.0.1:6379&gt; del age (integer) 1 redis 127.0.0.1:6379&gt; exists age (integer) 0</li><li>rename 重命名key 示例：age 成功的被我们改名为age_new 了 redis 127.0.0.1:6379[1]&gt; keys *<ol><li>“age” redis 127.0.0.1:6379[1]&gt; rename age age_new OK redis 127.0.0.1:6379[1]&gt; keys *</li><li>“age_new” redis 127.0.0.1:6379[1]&gt;</li></ol></li><li>type 返回值的类型 示例：这个方法可以非常简单的判断出值的类型 redis 127.0.0.1:6379&gt; type addr string redis 127.0.0.1:6379&gt; type myzset2 zset redis 127.0.0.1:6379&gt; type mylist list redis 127.0.0.1:6379&gt;</li></ul><h2 id="5-2-设置-key-的生存时间"><a href="#5-2-设置-key-的生存时间" class="headerlink" title="5.2 设置 key 的生存时间"></a>5.2 设置 key 的生存时间</h2><p>Redis在实际使用过程中更多的用作缓存，然而缓存的数据一般都是需要设置生存时间的，即：到期后数据销毁。</p><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">EXPIRE key seconds</td><td align="left">设置key的生存时间（单位：秒）key在多少秒后会自动删除</td></tr><tr><td align="left">TTL key</td><td align="left">查看key剩余的生存时间</td></tr><tr><td align="left">PERSIST key</td><td align="left">清除生存时间</td></tr><tr><td align="left">PEXPIRE key milliseconds</td><td align="left">生存时间设置单位为：毫秒</td></tr></tbody></table><p>例子：</p><pre class="line-numbers language-bash"><code class="language-bash">192.168.101.3:7002<span class="token operator">></span> <span class="token keyword">set</span> <span class="token function">test</span> 1        设置test的值为1
OK
192.168.101.3:7002<span class="token operator">></span> get <span class="token function">test</span>            获取test的值
<span class="token string">"1"</span>
192.168.101.3:7002<span class="token operator">></span> EXPIRE <span class="token function">test</span> 5    设置test的生存时间为5秒
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
192.168.101.3:7002<span class="token operator">></span> TTL <span class="token function">test</span>            查看test的生于生成时间还有1秒删除
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
192.168.101.3:7002<span class="token operator">></span> TTL <span class="token function">test</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2
192.168.101.3:7002<span class="token operator">></span> get <span class="token function">test</span>            获取test的值，已经删除
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="6-Redis-持久化方案"><a href="#6-Redis-持久化方案" class="headerlink" title="6. Redis 持久化方案"></a>6. Redis 持久化方案</h1><h2 id="6-1-Rdb-方式"><a href="#6-1-Rdb-方式" class="headerlink" title="6.1 Rdb 方式"></a>6.1 Rdb 方式</h2><p>Redis 默认的方式，redis 通过快照方式将数据持久化到磁盘中。</p><h3 id="6-1-1-设置持久化快照的条件"><a href="#6-1-1-设置持久化快照的条件" class="headerlink" title="6.1.1 设置持久化快照的条件"></a>6.1.1 设置持久化快照的条件</h3><p>在 redis.conf 中修改持久化快照的条件：</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120142.jpeg" alt="img"></p><h3 id="6-1-2-持久化文件的存储目录"><a href="#6-1-2-持久化文件的存储目录" class="headerlink" title="6.1.2 持久化文件的存储目录"></a>6.1.2 持久化文件的存储目录</h3><p>在 redis.conf 中可以指定持久化文件的存储目录</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120146.jpeg" alt="img"></p><h3 id="6-1-3-Rdb-的问题"><a href="#6-1-3-Rdb-的问题" class="headerlink" title="6.1.3 Rdb 的问题"></a>6.1.3 Rdb 的问题</h3><p>一旦redis非法关闭，那么会丢失最后一次持久化之后的数据。</p><p>如果数据不重要，则不必要关心。 如果数据不能允许丢失，那么要使用 aof 方式。</p><h2 id="6-2-Aof-方式"><a href="#6-2-Aof-方式" class="headerlink" title="6.2 Aof 方式"></a>6.2 Aof 方式</h2><p>Redis 默认是不使用该方式持久化的。Aof 方式的持久化，是操作一次 redis 数据库，则将操作的记录存储到 aof 持久化文件中。</p><ul><li><p>第一步：开启 aof 方式持久化方案。 将redis.conf中的appendonly改为yes，即开启aof方式的持久化方案。</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120152.jpeg" alt="img"></p></li><li><p>Aof文件存储的目录和rdb方式的一样。 Aof文件存储的名称</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120158.jpeg" alt="img"></p></li></ul><p>在使用aof和rdb方式时，如果redis重启，则数据从aof文件加载。</p><h1 id="7-Redis-的主从复制"><a href="#7-Redis-的主从复制" class="headerlink" title="7. Redis 的主从复制"></a>7. Redis 的主从复制</h1><h2 id="7-1-什么是主从复制"><a href="#7-1-什么是主从复制" class="headerlink" title="7.1 什么是主从复制"></a>7.1 什么是主从复制</h2><p>持久化保证了即使redis服务重启也不会丢失数据，因为redis服务重启后会将硬盘上持久化的数据恢复到内存中，但是当redis服务器的硬盘损坏了可能会导致数据丢失，如果通过redis的主从复制机制就可以避免这种单点故障，如下图：</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120203.jpeg" alt="img"></p><p>说明：</p><ul><li><p>主redis中的数据有两个副本（replication）即从redis1和从redis2，即使一台redis服务器宕机其它两台redis服务也可以继续提供服务。</p></li><li><p>主redis中的数据和从redis上的数据保持实时同步，当主redis写入数据时通过主从复制机制会复制到两个从redis服务上。</p></li><li><p>只有一个主redis，可以有多个从redis。</p></li><li><p>主从复制不会阻塞master，在同步数据时，master 可以继续处理client 请求</p></li><li><p>一个redis可以即是主又是从，如下图：</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120209.jpeg" alt="img"></p></li></ul><h2 id="7-2-主从复制设置"><a href="#7-2-主从复制设置" class="headerlink" title="7.2 主从复制设置"></a>7.2 主从复制设置</h2><h3 id="7-2-1-主机配置"><a href="#7-2-1-主机配置" class="headerlink" title="7.2.1 主机配置"></a>7.2.1 主机配置</h3><p>无需配置</p><h3 id="7-2-2-从机配置"><a href="#7-2-2-从机配置" class="headerlink" title="7.2.2 从机配置"></a>7.2.2 从机配置</h3><ul><li><p>第一步：复制出一个从机 <code>cp bin/ bin2 -r</code></p></li><li><p>第二步：修改从机的 redis.conf 语法：slaveof masterip masterport slaveof 192.168.242.137 6379</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120212.jpeg" alt="img"></p></li><li><p>第三步：修改从机的 port 地址为 6380</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120216.jpeg" alt="img"></p></li><li><p>第四步：清除从机的持久化文件 <code>rm -rf appendonly.aof dump.rdb</code></p></li><li><p>第五步：启动从机 <code>./redis-server redis.conf</code></p></li><li><p>第六步：启动6380的客户端 <code>./redis-cli -p 6380</code></p></li></ul><p><em>注意：</em> 主机一旦发生增删改操作，那么从机会将数据同步到从机中 从机不能执行写操作</p><h1 id="8-Redis-集群"><a href="#8-Redis-集群" class="headerlink" title="8. Redis 集群"></a>8. Redis 集群</h1><h2 id="8-1-redis-cluster-架构图"><a href="#8-1-redis-cluster-架构图" class="headerlink" title="8.1 redis-cluster 架构图"></a>8.1 redis-cluster 架构图</h2><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120219.jpeg" alt="img"></p><p>架构细节: (1)所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽. (2)节点的fail是通过集群中超过半数的节点检测失效时才生效. (3)客户端与redis节点直连,不需要中间proxy层.客户端不需要连接集群所有节点,连接集群中任何一个可用节点即可 (4)redis-cluster把所有的物理节点映射到[0-16383]slot上,cluster 负责维护node&lt;-&gt;slot&lt;-&gt;value Redis 集群中内置了 16384 个哈希槽，当需要在 Redis 集群中放置一个 key-value 时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点.</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120225.jpeg" alt="img"></p><h2 id="8-2-redis-cluster-投票-容错"><a href="#8-2-redis-cluster-投票-容错" class="headerlink" title="8.2 redis-cluster 投票 容错"></a>8.2 redis-cluster 投票 容错</h2><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120229.jpeg" alt="img"></p><p>(1)集群中所有master参与投票,如果半数以上master节点与其中一个master节点通信超过(cluster-node-timeout),认为该master节点挂掉. (2):什么时候整个集群不可用(cluster_state:fail)?</p><ul><li>如果集群任意master挂掉,且当前master没有slave，则集群进入fail状态。也可以理解成集群的[0-16383]slot映射不完全时进入fail状态。</li><li>如果集群超过半数以上master挂掉，无论是否有slave，集群进入fail状态。</li></ul><h2 id="8-3-安装-Ruby"><a href="#8-3-安装-Ruby" class="headerlink" title="8.3 安装 Ruby"></a>8.3 安装 Ruby</h2><p>集群管理工具（redis-trib.rb)是使用 ruby 脚本语言编写的。</p><ul><li>安装 ruby</li></ul><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ruby<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>上传 redis-3.0.0.gem 到 linux</li><li>安装 ruby 和 redis 接口 <code>gem install redis-3.0.0.gem</code></li><li>将 redis-3.0.0 包下 src 目录中的以下文件拷贝到 redis/redis-cluster/</li></ul><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> /usr/local/redis/
<span class="token function">mkdir</span> redis-cluster
<span class="token function">cd</span> /root/redis-3.0.0/src/
<span class="token function">cp</span> redis-trib.rb /usr/local/redis/redis-cluster<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8-4-搭建集群"><a href="#8-4-搭建集群" class="headerlink" title="8.4 搭建集群"></a>8.4 搭建集群</h2><p>搭建集群最少需要 3 台主机，如果每台主机再配置一台从机的话，则最少需要6台机器。 端口设计：7001-7006</p><ol><li><p>复制出一个7001机器 <code>cp bin ./redis-cluster/7001 -r</code></p></li><li><p>如果存在持久化文件，则删除 <code>rm -rf appendonly.aof dump.rdb</code></p></li><li><p>设置集群参数，修改redis.conf</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120245.jpeg" alt="img"></p></li><li><p>修改端口</p><p><img src="https://gitee.com//nfLJ/Pic/raw/master//Redis/20200729120249.jpeg" alt="img"></p></li><li><p>复制出7002-7006机器</p></li></ol><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cp</span> 7001/ 7002-r
<span class="token function">cp</span> 7001/ 7003-r
<span class="token function">cp</span> 7001/ 7004-r
<span class="token function">cp</span> 7001/ 7005-r
<span class="token function">cp</span> 7001/ 7006-r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>修改7002-7006机器端口</li><li>创建文件 start-all.sh</li></ol><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> 7001
./redis-server redis.conf
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">cd</span> 7002
./redis-server redis.conf
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">cd</span> 7003
./redis-server redis.conf
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">cd</span> 7004
./redis-server redis.conf
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">cd</span> 7005
./redis-server redis.conf
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">cd</span> 7006
./redis-server redis.conf
<span class="token function">cd</span> <span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>修改文件权限</li></ol><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span> u+x start-all.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>执行文件，启动六台机器</li></ol><pre class="line-numbers language-bash"><code class="language-bash">./start-all.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>创建集群 <code>./redis-trib.rb create --replicas 1 192.168.126.128:7001 192.168.126.128:7002 192.168.126.128:7003 192.168.126.128:7004 192.168.126.128:7005 192.168.126.128:7006</code></li></ol><h2 id="8-5-连接集群"><a href="#8-5-连接集群" class="headerlink" title="8.5 连接集群"></a>8.5 连接集群</h2><pre class="line-numbers language-bash"><code class="language-bash">root@ubuntu:/usr/local/redis/redis-cluster/7001<span class="token comment" spellcheck="true"># ./redis-cli -p 7001 -c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>-c 指定集群连接</p><h2 id="8-6-查看集群信息"><a href="#8-6-查看集群信息" class="headerlink" title="8.6 查看集群信息"></a>8.6 查看集群信息</h2><ul><li><p>查看集群信息</p><pre class="line-numbers language-bash"><code class="language-bash">  192.168.126.128:7002<span class="token operator">></span> cluster info
  cluster_state:ok
  cluster_slots_assigned:16384
  cluster_slots_ok:16384
  cluster_slots_pfail:0
  cluster_slots_fail:0
  cluster_known_nodes:6
  cluster_size:3
  cluster_current_epoch:6
  cluster_my_epoch:2
  cluster_stats_messages_sent:260
  cluster_stats_messages_received:260<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>查看集群节点</p><pre class="line-numbers language-bash"><code class="language-bash">  192.168.126.128:7002<span class="token operator">></span> cluster nodes
  3a15e73dacb512745156535ae7f959acf65ae12e 192.168.126.128:7005 slave 23e173cdc0b7673dc28cae70efaabbc41308bfdc 0 1531452321139 5 connected
  2a58a53a5b10f7bd91af04128a6ed439d534c0ee 192.168.126.128:7001 master - 0 1531452322145 1 connected 0-5460
  d0808388485dd08f1a2ecdfe3d2b213742d0050d 192.168.126.128:7004 slave 2a58a53a5b10f7bd91af04128a6ed439d534c0ee 0 1531452318117 4 connected
  23e173cdc0b7673dc28cae70efaabbc41308bfdc 192.168.126.128:7002 myself,master - 0 0 2 connected 5461-10922
  2af2312acc56552f9f73470f90d9a51973fc74d3 192.168.126.128:7006 slave 78faf92cfdbd12e1b27b270fb0798e67017f4d0b 0 1531452320132 6 connected
  78faf92cfdbd12e1b27b270fb0798e67017f4d0b 192.168.126.128:7007 master - 0 1531452319123 3 connected 10923-16383<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="8-7-jedis连接集群"><a href="#8-7-jedis连接集群" class="headerlink" title="8.7 jedis连接集群"></a>8.7 jedis连接集群</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jedisCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 创建jedisCluster</span>
        Set<span class="token operator">&lt;</span>HostAndPort<span class="token operator">></span> nodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7001</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7002</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7003</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7004</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7005</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7006</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">"192.168.242.137"</span><span class="token punctuation">,</span> <span class="token number">7007</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        JedisCluster cluster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisCluster</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cluster<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"s4"</span><span class="token punctuation">,</span> <span class="token string">"444"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        String result <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"s4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cluster<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8-8-使用-spring"><a href="#8-8-使用-spring" class="headerlink" title="8.8 使用 spring"></a>8.8 使用 spring</h2><p>配置 applicationContext.xml</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接池配置 <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"jedisPoolConfig"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.JedisPoolConfig"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最大连接数 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"maxTotal"</span> value<span class="token operator">=</span><span class="token string">"30"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 最大空闲连接数 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"maxIdle"</span> value<span class="token operator">=</span><span class="token string">"10"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 每次释放连接的最大数目 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"numTestsPerEvictionRun"</span> value<span class="token operator">=</span><span class="token string">"1024"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 释放连接的扫描间隔（毫秒） <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"timeBetweenEvictionRunsMillis"</span> value<span class="token operator">=</span><span class="token string">"30000"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接最小空闲时间 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"minEvictableIdleTimeMillis"</span> value<span class="token operator">=</span><span class="token string">"1800000"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接空闲多久后释放<span class="token punctuation">,</span> 当空闲时间<span class="token operator">></span>该值 且 空闲连接<span class="token operator">></span>最大空闲连接数 时直接释放 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"softMinEvictableIdleTimeMillis"</span> value<span class="token operator">=</span><span class="token string">"10000"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 获取连接时的最大等待毫秒数<span class="token punctuation">,</span>小于零<span class="token operator">:</span>阻塞不确定的时间<span class="token punctuation">,</span>默认<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"maxWaitMillis"</span> value<span class="token operator">=</span><span class="token string">"1500"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在获取连接的时候检查有效性<span class="token punctuation">,</span> 默认<span class="token boolean">false</span> <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"testOnBorrow"</span> value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在空闲时检查有效性<span class="token punctuation">,</span> 默认<span class="token boolean">false</span> <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"testWhileIdle"</span> value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接耗尽时是否阻塞<span class="token punctuation">,</span> <span class="token boolean">false</span>报异常<span class="token punctuation">,</span>ture阻塞直到超时<span class="token punctuation">,</span> 默认<span class="token boolean">true</span> <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"blockWhenExhausted"</span> value<span class="token operator">=</span><span class="token string">"false"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> redis集群 <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"jedisCluster"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.JedisCluster"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>set<span class="token operator">></span>
            <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.HostAndPort"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"192.168.101.3"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> value<span class="token operator">=</span><span class="token string">"7001"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
            <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.HostAndPort"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"192.168.101.3"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> value<span class="token operator">=</span><span class="token string">"7002"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
            <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.HostAndPort"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"192.168.101.3"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> value<span class="token operator">=</span><span class="token string">"7003"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
            <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.HostAndPort"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"192.168.101.3"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> value<span class="token operator">=</span><span class="token string">"7004"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
            <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.HostAndPort"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"192.168.101.3"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> value<span class="token operator">=</span><span class="token string">"7005"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
            <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"redis.clients.jedis.HostAndPort"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"0"</span> value<span class="token operator">=</span><span class="token string">"192.168.101.3"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
                <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> value<span class="token operator">=</span><span class="token string">"7006"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>set<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
    <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">"1"</span> ref<span class="token operator">=</span><span class="token string">"jedisPoolConfig"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试代码</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> ApplicationContext applicationContext<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>
                <span class="token string">"classpath:applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// redis集群</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJedisCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        JedisCluster jedisCluster <span class="token operator">=</span> <span class="token punctuation">(</span>JedisCluster<span class="token punctuation">)</span> applicationContext
                <span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"jedisCluster"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        jedisCluster<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String value <span class="token operator">=</span> jedisCluster<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>原创出处 <a href="https://juejin.im/post/5b4dd82ee51d451925629622" target="_blank" rel="noopener external nofollow noreferrer">https://juejin.im/post/5b4dd82ee51d451925629622</a> ,欢迎转载</p></blockquote></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">nfLJ</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="http://nflj.github.io/posts/b6db.html">http://nflj.github.io/posts/b6db.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">nfLJ</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Redis/"><span class="chip bg-color">Redis</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/share/css/share.min.css"><div id="article-share"></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/valine/av-min.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/valine/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"vYWENYxs7EpCcWebkdSHNMxa-gzGzoHsz",appKey:"MwxTkSIVQFgciapy0VwOOXEI",notify:!1,verify:!1,visitor:!0,avatar:"mm",pageSize:"10",lang:"zh-cn",placeholder:"快来交流吧"})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/86ed.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/featureimages/15.jpg" class="responsive-img" alt="OAuth 2.0 的四种方式"> <span class="card-title">OAuth 2.0 的四种方式</span></div></a><div class="card-content article-content"><div class="summary block-with-text">RFC 6749OAuth 2.0 的标准是 RFC 6749 文件。该文件先解释了 OAuth 是什么。 OAuth 引入了一个授权层，用来分离两种不同的角色：客户端和资源所有者。……资源所有者同意以后，资源服务器可以向客户端颁发令牌。</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-07-31</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/network/" class="post-category">network</a></span></div></div><div class="card-action article-tags"><a href="/tags/network/"><span class="chip bg-color">network</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/3b90.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/medias/featureimages/15.jpg" class="responsive-img" alt="JVM内存模型(基于JDK1.8)"> <span class="card-title">JVM内存模型(基于JDK1.8)</span></div></a><div class="card-content article-content"><div class="summary block-with-text">一、运行时数据区概览 JDK1.8同JDK1.7比，最大的差别就是：元数据区取代了永久代。元空间的本质和永久代类似，都是对JVM规范中方法区的实现。不过元空间与永久代之间最大的区别在于：元数据空间并不在虚拟机中，而是使用本地内存。 二、各区</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-07-07</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/JVM/" class="post-category">JVM</a></span></div></div><div class="card-action article-tags"><a href="/tags/JVM/"><span class="chip bg-color">JVM</span></a></div></div></div></div></article></div><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/codeBlock/codeBlockFuction.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/codeBlock/codeCopy.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/codeBlock/codeShrink.js"></script><style>code[class*=language-],pre[class*=language-]{white-space:pre!important}</style></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('6'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:0!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2020</span> <a href="/about" target="_blank">nfLJ</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" rel="external nofollow noreferrer" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" rel="external nofollow noreferrer" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">27.2k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次</span> <span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/nfLJ" rel="external nofollow noreferrer" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/js/search.js"></script><script>$(function(){searchFunc("https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script>WIDGET={FID:"UEjUyr0gWB"}</script><script src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/materialize/materialize.min.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/masonry/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/aos/aos.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/js/matery.js"></script><script src="https://cdn.jsdelivr.net/npm/bluebird@3/js/browser/bluebird.min.js"></script><script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@2.0.3/fetch.min.js"></script><script>fetch("https://v1.hitokoto.cn").then(function(t){return t.json()}).then(function(t){document.getElementById("hitokoto").innerText=t.hitokoto+"——【"+t.from+"】"}).catch(function(t){console.error(t)})</script><script src="https://cdn.jsdelivr.net/gh/nfLJ/CDN/js/ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/CDN/js/sakura.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/others/clicklove.js" async></script><script async src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/others/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/gh/nfLJ/nfLJ.github.io/libs/instantpage/instantpage.js" type="module"></script></body></html>